doctype html
html(lang="de")
    head
        meta(charset="UTF-8")
        meta(name="viewport", content="width=device-width, initial-scale=1.0")
        title #{title} - Techniker Dashboard
        meta(name="description", content="Performance Tracking & Analytics für Techniker")
        meta(name="keywords", content="Techniker, Dashboard, Analytics, IMEI, Performance")
        
        //- Favicon
        link(rel="icon", type="image/x-icon", href="/favicon.ico")
        link(rel="apple-touch-icon", sizes="180x180", href="/apple-touch-icon.png")
        
        //- Main CSS Bundle (enthält alle Basis-Styles)
        link(rel="stylesheet", href="/css/main.css")
        
        //- Font Awesome
        link(rel="stylesheet", href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css")
        
        //- Chart.js
        link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/chart.js")
        
        //- Page-specific styles
        block styles

    body
        .app-container
            //- Header
            header.app-header
                .header-content
                    a.logo(href="/", aria-label="Zurück zum Dashboard")
                        .logo-icon
                            i.fas.fa-tools
                        .logo-text
                            h1 Techniker Dashboard 2025
                            span.logo-tagline Performance Tracking & Analytics
                    
                    .header-actions
                        button.header-btn.header-btn-primary(onclick="generateReport()")
                            i.fas.fa-chart-bar
                            span Report erstellen
                        
                        button.header-btn.header-btn-secondary(onclick="analyzeMismatches()")
                            i.fas.fa-search
                            span Mismatch Analyse
                        
                        button.header-btn.header-btn-outline(onclick="importJSON()")
                            i.fas.fa-file-import
                            span JSON Import
                        
                        .header-search
                            i.search-icon.fas.fa-search
                            input.search-input(type="text", placeholder="Suchen...", aria-label="Suche")
                    
                    .header-extra-actions
                        button.header-btn.header-btn-outline(onclick="openModal('settingsModal')")
                            i.fas.fa-cog
                            span Einstellungen
                        
                        .user-menu
                            button.user-btn(onclick="toggleUserMenu()")
                                .user-avatar TS
                                .user-info
                                    .user-name Techniker Support
                                    .user-role Administrator
                        
                        .quick-actions-menu
                            button.quick-action-btn(onclick="toggleTheme()", aria-label="Theme wechseln")
                                i.fas.fa-moon
                            button.quick-action-btn(onclick="toggleNotifications()", aria-label="Benachrichtigungen")
                                i.fas.fa-bell
                            button.quick-action-btn(onclick="toggleFullscreen()", aria-label="Vollbild")
                                i.fas.fa-expand
            
            //- Main Content
            main.app-main
                block content
            
            //- Footer
            footer.app-footer
                .footer-content
                    .footer-left
                        .footer-status
                            .status-indicator.online
                            span#statusLabel System bereit
                        
                        .footer-version v2.5.1
                    
                    .footer-center
                        .footer-links
                            a.footer-link(href="/documentation")
                                i.fas.fa-book
                                span Dokumentation
                            a.footer-link(href="/privacy")
                                i.fas.fa-shield-alt
                                span Datenschutz
                            a.footer-link(href="/terms")
                                i.fas.fa-file-contract
                                span AGB
                            a.footer-link(href="/imprint")
                                i.fas.fa-building
                                span Impressum
                    
                    .footer-right
                        .footer-actions
                            button.footer-btn(onclick="openModal('helpModal')", aria-label="Hilfe")
                                i.fas.fa-question-circle
                            button.footer-btn(onclick="toggleSound()", aria-label="Sound")
                                i.fas.fa-volume-up
                            button.footer-btn(onclick="printPage()", aria-label="Drucken")
                                i.fas.fa-print
                        
                        .footer-social
                            a.social-link.github(href="https://github.com", target="_blank", rel="noopener", aria-label="GitHub")
                                i.fab.fa-github
                            a.social-link.twitter(href="https://twitter.com", target="_blank", rel="noopener", aria-label="Twitter")
                                i.fab.fa-twitter
                            a.social-link.discord(href="https://discord.com", target="_blank", rel="noopener", aria-label="Discord")
                                i.fab.fa-discord
                
                .footer-copyright
                    | &copy; 2025 Techniker Dashboard. 
                    a(href="/") Alle Rechte vorbehalten.
                    |  
                    span.footer-badges
                        span.footer-badge
                            i.fas.fa-shield-alt
                            span SSL gesichert
                        span.footer-badge
                            i.fas.fa-bolt
                            span Realtime
            
            //- Modals
            include includes/modals.pug
        
        //- Main JavaScript
        script(src="/js/dashboard.js")
        
        //- Initialize theme
        script.
            // Load theme from localStorage
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            // Initialize app
            document.addEventListener('DOMContentLoaded', () => {
                document.querySelector('.app-container').classList.add('loaded');
                
                // Update status
                updateSystemStatus();
                
                // Initialize tooltips
                initializeTooltips();
            });
            
            function updateSystemStatus() {
                const statusLabel = document.getElementById('statusLabel');
                const indicator = document.querySelector('.status-indicator');
                
                // Simulate status check
                fetch('/api/status')
                    .then(response => {
                        if (response.ok) {
                            statusLabel.textContent = 'System bereit';
                            indicator.className = 'status-indicator online';
                        } else {
                            statusLabel.textContent = 'System gestört';
                            indicator.className = 'status-indicator warning';
                        }
                    })
                    .catch(() => {
                        statusLabel.textContent = 'Offline';
                        indicator.className = 'status-indicator offline';
                    });
            }
            
            function toggleTheme() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
            }
            
            function toggleFullscreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log(`Error attempting to enable fullscreen: ${err.message}`);
                    });
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    }
                }
            }
            
            function toggleSound() {
                const soundEnabled = localStorage.getItem('sound') !== 'false';
                localStorage.setItem('sound', !soundEnabled);
                
                const button = document.querySelector('[aria-label="Sound"] i');
                button.className = soundEnabled ? 'fas fa-volume-mute' : 'fas fa-volume-up';
            }
            
            function printPage() {
                window.print();
            }
            
            function initializeTooltips() {
                // Initialize tooltips for elements with data-tooltip attribute
                const tooltipElements = document.querySelectorAll('[data-tooltip]');
                tooltipElements.forEach(el => {
                    el.addEventListener('mouseenter', showTooltip);
                    el.addEventListener('mouseleave', hideTooltip);
                });
            }
            
            function showTooltip(e) {
                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip';
                tooltip.textContent = e.target.dataset.tooltip;
                document.body.appendChild(tooltip);
                
                const rect = e.target.getBoundingClientRect();
                tooltip.style.left = `${rect.left + rect.width / 2}px`;
                tooltip.style.top = `${rect.top - 10}px`;
                tooltip.style.transform = 'translateX(-50%)';
                
                e.target.tooltipElement = tooltip;
            }
            
            function hideTooltip(e) {
                if (e.target.tooltipElement) {
                    e.target.tooltipElement.remove();
                    e.target.tooltipElement = null;
                }
            }
        
        //- Page-specific scripts
        block scripts