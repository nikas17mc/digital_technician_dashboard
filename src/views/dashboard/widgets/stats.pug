//- ./src/views/dashboard/widgets/device-stats.pug

mixin stats(stats, jobQueue)
    - var defaultStats = {devices: {key: 'primary',title: 'Total Devices',total: 0,progress: 'positive',percent: 12,icon: 'fa-mobile'},repair: {key: 'pending',title: 'In Repair',total: 0,progress: 'negative',percent: 5,icon: 'fa-wrench'},quickCheck: {key: 'quickCheck',title: 'Awaiting QC',total: 0,progress: 'positive',percent: 8,icon: 'fa-clipboard-check'},reworkRate: {key: 'reworkRate',title: 'Rework Rate',total: 0,progress: 'negative',percent: 2,icon: 'fa-triangle-exclamation'}};
    - var defaultJobQueue = {unsynced: {key: 'pending', icon: "fa-arrows-rotate", total: 2, title: "Unsynced", subTitle: "Device need Plenty Sync", url: "/sync"}, lowStock: {key: 'destructive', icon: "fa-box", total: 1, title: "Low Stock", subTitle: "Parts need recorder", url: "/parts"}, discrepancies: {key: 'secondary', icon: "fa-arrow-up-right", total: 2, title: "Discrepancies", subTitle: "Inventory mismatches", url: "/reports"}}
    - var deepMerge = (d, s) => {for(var p in s) {try {if (s[p].constructor == Object){d[p] = deepMerge(d[p], s[p]);} else {d[p] = s[p];};} catch(e) {d[p] = s[p];}}return d;};

    .dashboard__header--container
        each item in deepMerge(defaultStats, stats)
            .dashboard__header__container--widgetCard(class=`is-${item.key}`)
                .dashboard__header__container__widgetCard--info
                    .left
                        p.left--title= item.title
                        p.left--counter(data-animation-counter)= item.total
                        .left--extraInfo(class=`is-${item.progress}`)
                            i(class=`far fa-arrow-${item.progress === 'positive' ? 'up' : 'down'}-right fa-lg`)
                            span.left__extraInfo--chartShow(class=`is-${item.progress}`) #{item.percent}% from yesterday
                    .right
                        i(class=`far ${item.icon} fa-lg`)
    .dashboard__extraHeader--container
        each item in deepMerge(defaultJobQueue, jobQueue)
            .dashboard__extraHeader__container--widgetCard(class=`is-${item.key}`)
                .dashboard__extraHeader__container__widgetCard--info
                    .left
                        i(class=`far ${item.icon} fa-lg`)
                    .middle 
                        p.title= `${item.total+" "+item.title}`
                        p.subtitle= `${item.subTitle}`
                    button.right(type="submit" formaction=`${item.url}` disabled=`${item.total !== 0 ? 'false' : 'true'}`) View